{
  "id": "snapshot_1766485583518_vsokd8lqw",
  "approvalId": "approval_1766485422513_0zs5r4coa",
  "approvalTitle": "Design Document - Newspaper Article Layout",
  "version": 2,
  "timestamp": "2025-12-23T10:26:23.518Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Design Document\n\n## Overview\n\nThis feature transforms the article viewing experience from a basic blog-style layout to a professional digital newspaper presentation. The design implements a foundational styling layer that enhances all articles while preserving template-specific customizations. The solution leverages React components, Tailwind CSS, and CSS Grid/Flexbox to create newspaper-style layouts with multi-column text, enhanced typography, styled pull quotes, and improved visual hierarchy.\n\nThe implementation focuses on creating reusable, modular components that can be integrated into both `PublicArticle.tsx` (public viewing) and potentially other article display contexts. The design ensures backward compatibility with the existing template system while providing immediate visual improvements for all articles.\n\n## Steering Document Alignment\n\n### Technical Standards\n\nSince steering documents do not exist for this project, the design follows the established patterns found in the codebase:\n\n- **TypeScript Strict Mode**: All components use strict TypeScript with proper interfaces\n- **React Functional Components**: Use hooks (useState, useEffect, useMemo) following existing patterns\n- **Tailwind CSS First**: Styling primarily through Tailwind utility classes\n- **Component Modularity**: Small, focused components with single responsibilities\n- **i18n Support**: Integration with react-i18next for multilingual content (EN/ES)\n- **API Client Pattern**: Use fetch API with proper error handling\n- **Conventional Commits**: Follow project's commit message standards\n\n### Project Structure\n\nThe implementation follows the existing project structure:\n\n```\nsrc/client/\n├── components/\n│   ├── ArticleLayout/        # NEW: Newspaper layout components\n│   │   ├── ColumnLayout.tsx\n│   │   ├── DropCap.tsx\n│   │   ├── PullQuote.tsx\n│   │   ├── ImageCaption.tsx\n│   │   ├── ArticleHeader.tsx\n│   │   ├── RelatedArticlesSidebar.tsx\n│   │   └── NewspaperArticle.tsx  # Main wrapper component\n│   └── PublicArticle/         # Existing disclaimer components\n├── pages/\n│   └── PublicArticle.tsx      # Modified to use new layout\n└── styles/\n    └── newspaper.css          # NEW: Base newspaper styles\n```\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n\n- **DisclaimerBanner**: Already sticky and well-positioned; will remain above newspaper layout\n- **DisclaimerFooter**: Will be positioned below newspaper content\n- **Watermark**: Overlays content; continues working without modification\n- **PublicArticle.tsx Structure**: Existing fetch logic, error handling, and loading states will be preserved\n\n### Existing Patterns to Follow\n\n- **Component Documentation**: JSDoc-style comments explaining purpose (seen in DisclaimerBanner.tsx:3-11)\n- **i18n Usage**: `useTranslation()` hook for all user-facing text\n- **Responsive Grid**: `grid grid-cols-1 lg:grid-cols-3 gap-8` pattern from PublicArticle.tsx:116\n- **Brand Color Injection**: `style={{ color: article.brand.primaryColor }}` pattern (PublicArticle.tsx:129)\n- **Tailwind Styling**: Extensive use of utility classes for responsive design\n\n### Integration Points\n\n#### Template System Integration\n- **Database**: No changes to Prisma schema; Template model remains unchanged\n- **CSS Cascade**: New newspaper styles load before template.cssStyles\n- **HTML Structure**: template.htmlStructure is injected into article content area\n- **Brand Colors**: Use article.brand.primaryColor and accentColor for accents\n\n#### Article Data Model\nCurrent Article interface (PublicArticle.tsx:9-31) provides:\n- `content`: HTML string for article body\n- `featuredImage`: Optional header image\n- `brand`: Object with colors, logo, name\n- `relatedArticles`: Array for sidebar\n- `tags`, `category`, `authorName`, `publishedAt`: Metadata for header\n\nNo backend changes required; all enhancements are client-side presentation.\n\n## Architecture\n\n### Modular Design Principles\n\nThe design follows strict modularity:\n\n1. **Component Isolation**: Each layout feature (drop caps, pull quotes, columns) is a separate component\n2. **Single File Responsibility**:\n   - `DropCap.tsx`: Only handles first-letter styling\n   - `PullQuote.tsx`: Only handles blockquote rendering\n   - `ColumnLayout.tsx`: Only handles multi-column text distribution\n3. **Composition Over Configuration**: Main `NewspaperArticle` component composes smaller pieces\n4. **Style Separation**: Base newspaper CSS in dedicated file, component-specific styles via Tailwind\n\n### Component Architecture\n\n```mermaid\ngraph TD\n    A[PublicArticle.tsx] --> B[NewspaperArticle Component]\n    B --> C[ArticleHeader]\n    B --> D[ColumnLayout]\n    B --> E[RelatedArticlesSidebar]\n\n    C --> C1[Featured Image with Gradient]\n    C --> C2[Title/Subtitle]\n    C --> C3[Byline & Meta]\n\n    D --> D1[DropCap]\n    D --> D2[Content Sections]\n    D2 --> D3[PullQuote]\n    D2 --> D4[ImageCaption]\n\n    E --> E1[Related Article Cards]\n\n    style B fill:#e1f5fe\n    style C fill:#fff3e0\n    style D fill:#f3e5f5\n    style E fill:#e8f5e9\n```\n\n### CSS Strategy\n\n1. **Base Layer** (newspaper.css):\n   - Typography: Serif for body, sans-serif for headings\n   - Column layout utilities\n   - Drop cap styles\n   - Pull quote base styles\n\n2. **Tailwind Layer** (component classes):\n   - Responsive breakpoints\n   - Spacing and sizing\n   - Colors (with brand color overrides)\n\n3. **Template Layer** (template.cssStyles):\n   - Highest specificity\n   - Can override base styles\n   - Loaded after base styles\n\n### Responsive Strategy\n\n- **Mobile (<768px)**: Single column, stacked layout, related articles below content\n- **Tablet (768px-1023px)**: Single column with optimal line length, sticky sidebar\n- **Desktop (≥1024px)**: Two-column content after first paragraph, sticky sidebar\n\n## Components and Interfaces\n\n### Component 1: NewspaperArticle\n\n**Purpose:** Main wrapper component that orchestrates the newspaper layout\n\n**Interface:**\n```typescript\ninterface NewspaperArticleProps {\n  article: {\n    id: string;\n    title: string;\n    subtitle?: string;\n    content: string; // HTML string\n    excerpt: string;\n    authorName: string;\n    publishedAt: string;\n    readTime?: number;\n    featuredImage?: string;\n    category: string;\n    tags: string[];\n    brand: {\n      name: string;\n      primaryColor: string;\n      accentColor: string;\n      logoUrl?: string;\n    };\n    relatedArticles: RelatedArticle[];\n  };\n}\n```\n\n**Dependencies:** ArticleHeader, ColumnLayout, RelatedArticlesSidebar, useTranslation\n\n**Reuses:** Existing article data structure from PublicArticle.tsx\n\n---\n\n### Component 2: DropCap\n\n**Purpose:** Renders first letter of first paragraph as a decorative drop cap\n\n**Interface:**\n```typescript\ninterface DropCapProps {\n  children: string; // First character\n  brandColor?: string; // Optional brand accent color\n}\n```\n\n**Dependencies:** None\n\n**Reuses:** Brand color injection pattern from PublicArticle.tsx\n\n**Implementation Notes:**\n- Extract first character from content\n- Apply 2-3 line height\n- Use brand accent color or default to elegant serif\n- CSS: `float: left`, proper margin and padding\n\n---\n\n### Component 3: PullQuote\n\n**Purpose:** Renders blockquotes as visually distinct pull quotes\n\n**Interface:**\n```typescript\ninterface PullQuoteProps {\n  children: React.ReactNode; // Quote content\n  attribution?: string; // Optional quote source\n  brandColor?: string;\n}\n```\n\n**Dependencies:** useTranslation (for \"—\" attribution formatting)\n\n**Reuses:** Brand color for border accent\n\n**Implementation Notes:**\n- Larger font size (1.25rem)\n- Decorative quotation marks (::before, ::after)\n- Left border or background tint using brand color\n- Minimum 2rem spacing above/below\n- Desktop: Can be floated or centered\n\n---\n\n### Component 4: ImageCaption\n\n**Purpose:** Renders images with captions and photo credits\n\n**Interface:**\n```typescript\ninterface ImageCaptionProps {\n  src: string;\n  alt: string;\n  caption?: string;\n  credit?: string;\n}\n```\n\n**Dependencies:** None\n\n**Reuses:** Existing image rendering pattern\n\n**Implementation Notes:**\n- Responsive image sizing\n- Caption in smaller, italic text below image\n- Credit in even smaller gray text\n- Proper spacing (1.5rem) from surrounding text\n\n---\n\n### Component 5: ColumnLayout\n\n**Purpose:** Distributes article content into newspaper-style columns\n\n**Interface:**\n```typescript\ninterface ColumnLayoutProps {\n  content: string; // HTML string\n  brandColor?: string;\n}\n```\n\n**Dependencies:** DropCap, PullQuote, ImageCaption, useMemo (for content parsing)\n\n**Reuses:** dangerouslySetInnerHTML pattern from PublicArticle.tsx:165\n\n**Implementation Notes:**\n- Parse HTML to identify paragraphs, blockquotes, images\n- First paragraph: single column with drop cap\n- Subsequent paragraphs: two-column on desktop\n- Break columns for full-width elements (images, pull quotes)\n- Use CSS `column-count` or CSS Grid for column distribution\n- Prevent orphaned lines with `break-inside: avoid`\n\n---\n\n### Component 6: ArticleHeader\n\n**Purpose:** Renders article title, subtitle, byline, and featured image with overlay\n\n**Interface:**\n```typescript\ninterface ArticleHeaderProps {\n  title: string;\n  subtitle?: string;\n  authorName: string;\n  publishedAt: string;\n  readTime?: number;\n  category: string;\n  featuredImage?: string;\n  brandColor: string;\n}\n```\n\n**Dependencies:** useTranslation\n\n**Reuses:** Existing metadata rendering from PublicArticle.tsx:139-151\n\n**Implementation Notes:**\n- If featuredImage exists: large image with gradient overlay, title overlaid in white\n- If no image: standard header with title, subtitle\n- Byline section: author • date • read time • category\n- Social share icons (optional, can be added in future task)\n- Category tag styled with brand color\n\n---\n\n### Component 7: RelatedArticlesSidebar\n\n**Purpose:** Displays related articles in a sidebar (desktop) or horizontal carousel (mobile)\n\n**Interface:**\n```typescript\ninterface RelatedArticle {\n  id: string;\n  title: string;\n  slug: string;\n  featuredImage?: string;\n  category: string;\n}\n\ninterface RelatedArticlesSidebarProps {\n  articles: RelatedArticle[];\n  brandColor: string;\n  onArticleClick?: (slug: string) => void;\n}\n```\n\n**Dependencies:** useTranslation, useState (for carousel on mobile)\n\n**Reuses:** Existing related articles from PublicArticle.tsx:186-203\n\n**Implementation Notes:**\n- Desktop: Sticky sidebar (top-24) with card-based layout\n- Mobile/Tablet: Horizontal scrollable carousel or stacked list\n- Each item: thumbnail, title, category badge\n- Click handler navigates to article\n- Sticky behavior respects footer (doesn't overlap)\n\n## Data Models\n\n### ArticleContent (Parsed Structure)\n\n```typescript\ninterface ParsedContent {\n  elements: ContentElement[];\n}\n\ninterface ContentElement {\n  type: 'paragraph' | 'blockquote' | 'image' | 'heading';\n  content: string;\n  metadata?: {\n    caption?: string;\n    credit?: string;\n    attribution?: string;\n  };\n}\n```\n\n**Purpose:** Internal representation of parsed article HTML for layout distribution\n\n**Usage:** ColumnLayout component parses article.content into this structure to apply layout rules\n\n---\n\n### NewspaperLayoutConfig (Optional Future Enhancement)\n\n```typescript\ninterface NewspaperLayoutConfig {\n  columnCount?: number; // 1 or 2, default 2 on desktop\n  dropCapEnabled?: boolean; // default true\n  pullQuoteStyle?: 'bordered' | 'background' | 'centered';\n  fontScale?: 'compact' | 'standard' | 'comfortable';\n}\n```\n\n**Purpose:** Future configuration to allow template-level customization\n\n**Note:** Not implemented in initial version; all articles use same layout rules\n\n## Error Handling\n\n### Error Scenarios\n\n#### 1. Malformed HTML Content\n**Description:** Article content contains invalid or dangerous HTML\n\n**Handling:**\n- Use `rehype-sanitize` (already in package.json) to sanitize HTML\n- Fallback to plain text if sanitization fails\n- Log error with article ID for debugging\n\n**User Impact:** Article displays safely without malicious scripts; layout may be simplified\n\n---\n\n#### 2. Missing or Broken Images\n**Description:** featuredImage or content images fail to load\n\n**Handling:**\n- Use img `onError` handler to hide broken images\n- Display alt text with styled placeholder\n- Log warning (don't break layout)\n\n**User Impact:** Article remains readable; missing images don't create visual gaps\n\n---\n\n#### 3. Extremely Long Paragraphs\n**Description:** Content has paragraphs >1000 words causing layout issues\n\n**Handling:**\n- CSS `overflow-wrap: break-word` to prevent horizontal scroll\n- Max width constraints on paragraphs\n- Column layout naturally breaks long text\n\n**User Impact:** Text wraps correctly; no horizontal scrolling\n\n---\n\n#### 4. No Related Articles\n**Description:** relatedArticles array is empty\n\n**Handling:**\n- Conditionally render sidebar only if articles exist\n- Main content expands to full width (adjust grid cols)\n\n**User Impact:** Clean layout without empty sidebar\n\n---\n\n#### 5. Template CSS Conflicts\n**Description:** template.cssStyles override newspaper layout in unexpected ways\n\n**Handling:**\n- Use CSS specificity (newspaper base styles have lower specificity)\n- Namespace newspaper styles with `.newspaper-layout` class\n- Document override points for template authors\n\n**User Impact:** Template customizations take precedence; layout degrades gracefully\n\n## Testing Strategy\n\n### Unit Testing\n\n**Framework:** Jest + React Testing Library (already configured)\n\n**Components to Test:**\n1. **DropCap**:\n   - Renders first character correctly\n   - Applies brand color when provided\n   - Falls back to default color\n\n2. **PullQuote**:\n   - Renders quote content\n   - Displays attribution when provided\n   - Applies brand color to border/accent\n\n3. **ImageCaption**:\n   - Renders image with caption and credit\n   - Handles missing caption/credit gracefully\n\n4. **ArticleHeader**:\n   - Displays all metadata correctly\n   - Handles missing subtitle/featured image\n   - Formats dates correctly\n\n5. **RelatedArticlesSidebar**:\n   - Renders list of related articles\n   - Handles empty array\n   - Click handlers work correctly\n\n**Example Test:**\n```typescript\n// tests/unit/components/DropCap.test.tsx\ndescribe('DropCap', () => {\n  it('renders first character with brand color', () => {\n    render(<DropCap brandColor=\"#ff0000\">T</DropCap>);\n    const dropCap = screen.getByText('T');\n    expect(dropCap).toHaveStyle({ color: '#ff0000' });\n  });\n});\n```\n\n---\n\n### Integration Testing\n\n**Framework:** Jest + Supertest (for API), React Testing Library (for components)\n\n**Flows to Test:**\n1. **Full Article Rendering**:\n   - Fetch article from API\n   - Render NewspaperArticle component\n   - Verify all sections render (header, content, sidebar)\n   - Check responsive breakpoints\n\n2. **Template Integration**:\n   - Render article with custom template\n   - Verify template CSS loads after newspaper CSS\n   - Ensure template styles apply correctly\n\n3. **Content Parsing**:\n   - Parse HTML content with various elements\n   - Verify paragraphs, blockquotes, images detected\n   - Check column layout distribution\n\n**Example Test:**\n```typescript\n// tests/integration/NewspaperArticle.test.tsx\ndescribe('NewspaperArticle Integration', () => {\n  it('renders article with all components', async () => {\n    const article = await fetchMockArticle();\n    render(<NewspaperArticle article={article} />);\n\n    expect(screen.getByText(article.title)).toBeInTheDocument();\n    expect(screen.getByText(/Related Articles/i)).toBeInTheDocument();\n    expect(screen.getAllByRole('article')).toHaveLength(1);\n  });\n});\n```\n\n---\n\n### End-to-End Testing\n\n**Framework:** Playwright (already configured)\n\n**User Scenarios to Test:**\n\n1. **Public Article Viewing - Desktop**:\n   - Navigate to article URL\n   - Verify two-column layout appears\n   - Check drop cap on first paragraph\n   - Scroll to verify sticky sidebar\n   - Verify disclaimer banner remains visible\n\n2. **Public Article Viewing - Mobile**:\n   - Navigate to article on mobile viewport\n   - Verify single-column layout\n   - Check related articles appear below content\n   - Verify responsive images\n\n3. **Article with Custom Template**:\n   - Navigate to article with extracted template\n   - Verify newspaper layout and template styles both apply\n   - Check brand colors appear correctly\n\n4. **Accessibility**:\n   - Navigate article with keyboard only\n   - Verify focus indicators visible\n   - Run axe-core accessibility checks\n   - Test with screen reader (VoiceOver/NVDA)\n\n**Example E2E Test:**\n```typescript\n// tests/e2e/newspaper-layout.spec.ts\nimport { test, expect } from '@playwright/test';\n\ntest('article displays in newspaper layout on desktop', async ({ page }) => {\n  await page.goto('/nytimes/article/2025/01/sample-article');\n\n  // Check two-column layout on desktop\n  await page.setViewportSize({ width: 1920, height: 1080 });\n  const columns = await page.locator('.newspaper-columns').count();\n  expect(columns).toBeGreaterThan(0);\n\n  // Verify drop cap\n  const dropCap = page.locator('.drop-cap').first();\n  await expect(dropCap).toBeVisible();\n\n  // Check sticky sidebar\n  const sidebar = page.locator('[data-testid=\"related-articles-sidebar\"]');\n  await expect(sidebar).toHaveCSS('position', 'sticky');\n});\n```\n\n---\n\n### Visual Regression Testing (Future Enhancement)\n\n**Tools:** Percy or Chromatic (not currently in project)\n\n**Scenarios:**\n- Capture baseline screenshots of articles\n- Compare layout changes across breakpoints\n- Detect unintended CSS changes\n\n**Note:** Not included in initial implementation; can be added in future iterations\n\n## Performance Considerations\n\n### CSS Bundle Size\n- Base newspaper.css: Target <5KB (minified)\n- Use Tailwind purge to remove unused classes\n- Inline critical CSS for above-the-fold content\n\n### Layout Calculation\n- Content parsing happens once, memoized with useMemo\n- Column distribution uses CSS Grid (GPU accelerated)\n- Avoid JavaScript layout calculations on scroll\n\n### Image Optimization\n- Lazy load below-the-fold images\n- Use responsive images (srcset) if available\n- Compress featured images (Sharp already in package.json)\n\n### Render Performance\n- Component memoization with React.memo for pure components\n- Avoid re-parsing content on every render\n- Minimize DOM depth in column layout\n\n## Accessibility\n\n### Semantic HTML\n- Use `<article>`, `<header>`, `<aside>`, `<blockquote>` elements\n- Proper heading hierarchy (h1 → h2 → h3)\n- Alt text for all images\n\n### Keyboard Navigation\n- All interactive elements focusable\n- Visible focus indicators (ring-2 ring-blue-500)\n- Skip to content link (optional enhancement)\n\n### Screen Reader Support\n- Proper ARIA labels for sidebar sections\n- sr-only class for visual indicators that need text equivalents\n- Announce related articles count\n\n### Color Contrast\n- Body text: 4.5:1 minimum (WCAG AA)\n- Large text (headings): 3:1 minimum\n- Test brand colors for sufficient contrast\n- Provide fallback if brand colors fail contrast\n\n### Responsive Text\n- Support text zoom to 200% without horizontal scroll\n- Relative units (rem, em) instead of fixed pixels\n- Readable line length at all zoom levels\n\n## Template Integration Specification\n\n### CSS Cascade Order\n\n1. **Reset & Base** (globals.css)\n2. **Tailwind Base Layer** (@tailwind base)\n3. **Newspaper Base Styles** (newspaper.css)\n4. **Tailwind Components** (@tailwind components)\n5. **Component Inline Styles** (Tailwind utilities in JSX)\n6. **Template Styles** (template.cssStyles injected)\n7. **Tailwind Utilities** (@tailwind utilities)\n\n### Template Override Points\n\nTemplates can customize newspaper layout by including these CSS variables:\n\n```css\n/* In template.cssStyles */\n.newspaper-layout {\n  --newspaper-column-count: 1; /* Override to disable columns */\n  --newspaper-font-body: 'Custom Serif', serif;\n  --newspaper-font-heading: 'Custom Sans', sans-serif;\n  --newspaper-drop-cap-size: 4rem; /* Customize drop cap */\n}\n```\n\n### Brand Color Application\n\nBrand colors applied via inline styles (highest specificity):\n- Links: `article.brand.accentColor`\n- Section dividers: `article.brand.primaryColor`\n- Pull quote borders: `article.brand.accentColor`\n- Category badges: `article.brand.accentColor`\n\nTemplates can override by using `!important` in their CSS (not recommended but supported).\n\n## Migration Path\n\n### Phase 1: Initial Implementation (This Spec)\n- Create all newspaper layout components\n- Update PublicArticle.tsx to use NewspaperArticle component\n- Add newspaper.css base styles\n- Test with default templates\n\n### Phase 2: Template Compatibility (Future)\n- Test with all extracted templates\n- Document override patterns for template authors\n- Create template testing suite\n\n### Phase 3: Customization (Future)\n- Add NewspaperLayoutConfig to Template model\n- UI for template authors to customize layout\n- Per-template layout preferences\n\n### Phase 4: Advanced Features (Future)\n- Floating images within columns\n- Interactive elements (footnotes, annotations)\n- Print stylesheet for physical newspapers\n- Social share integration\n\n## Open Questions & Future Considerations\n\n1. **Content Parsing**: Should we use a proper HTML parser library (jsdom, htmlparser2) or DOMParser API?\n   - **Decision:** Use browser's DOMParser API (no additional dependencies)\n\n2. **Column Distribution**: CSS columns or CSS Grid?\n   - **Decision:** Start with CSS columns for simplicity; can migrate to Grid for advanced layouts\n\n3. **Mobile Related Articles**: Carousel or stacked list?\n   - **Decision:** Stacked list (simpler, more accessible); carousel can be future enhancement\n\n4. **Drop Cap**: Always on first paragraph or configurable?\n   - **Decision:** Always on first paragraph; configurable in Phase 3\n\n5. **Social Share Icons**: Include in ArticleHeader or separate component?\n   - **Decision:** Separate component, added in future task (out of scope for this spec)\n\n6. **Print Styles**: Should we include newspaper-quality print CSS?\n   - **Decision:** Future enhancement (Phase 4); focus on screen presentation first\n\n7. **RTL Support**: How to handle right-to-left languages?\n   - **Decision:** Out of scope for initial implementation (project supports EN/ES only)\n\n## Dependencies\n\n### New Dependencies\n- None (all features use existing dependencies)\n\n### Existing Dependencies Used\n- `react`, `react-dom`: Component framework\n- `tailwindcss`: Styling utilities\n- `react-i18next`: Internationalization\n- `react-helmet-async`: SEO meta tags\n- `rehype-sanitize`: HTML sanitization (security)\n\n## Success Metrics\n\n### User Experience\n- Article read time increases by 20% (more engagement)\n- Bounce rate decreases (better retention)\n- Positive user feedback on visual improvements\n\n### Technical\n- CSS bundle size increase <5KB\n- No performance regression (Lighthouse score ≥90)\n- Zero accessibility violations (axe-core)\n- All tests passing (unit, integration, E2E)\n\n### Business\n- Articles appear more professional/authentic\n- Easier to demonstrate value to potential users\n- Enhanced brand differentiation\n",
  "fileStats": {
    "size": 23131,
    "lines": 760,
    "lastModified": "2025-12-23T10:23:32.278Z"
  },
  "comments": []
}