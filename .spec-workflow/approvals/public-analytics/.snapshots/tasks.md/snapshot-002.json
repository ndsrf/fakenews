{
  "id": "snapshot_1765719655044_qrsm1flu7",
  "approvalId": "approval_1765718866119_s8p92gr6l",
  "approvalTitle": "Tasks: Public Display, Analytics & Production (Phase 3)",
  "version": 2,
  "timestamp": "2025-12-14T13:40:55.044Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Tasks Document\n\n## Phase 3: Public Display, Analytics & Production\n\n### 1. Core Utilities\n\n- [-] 1.1. Create IP anonymization utility\n  - File: src/server/utils/ipAnonymizer.ts\n  - Implement SHA-256 hashing for IP addresses\n  - Add tests for consistent hashing\n  - Purpose: GDPR-compliant IP anonymization\n  - _Leverage: Node.js crypto module_\n  - _Requirements: Requirement 2 (Analytics Tracking - anonymized IP), Non-functional (Security - IP hashing)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Security Developer with expertise in cryptography and data privacy | Task: Create IP anonymization utility implementing SHA-256 hashing for IP addresses following Requirement 2 and Security non-functional requirements for GDPR compliance | Restrictions: Must use SHA-256 (not MD5/SHA1), do not log raw IP addresses, ensure consistent hashing for same IP | Leverage: Node.js crypto module | Requirements: Requirement 2, Security NFR | Success: Utility exports anonymizeIP function, hashes are consistent, includes unit tests with known IP/hash pairs, no raw IPs logged | Implementation: After completing, mark task 1.1 as in-progress in tasks.md, implement the utility, run tests, then use log-implementation tool with detailed artifacts (functions: anonymizeIP with signature and location), and mark as complete in tasks.md_\n\n- [ ] 1.2. Create user agent parser utility\n  - File: src/server/utils/userAgentParser.ts\n  - Parse browser, OS, device type from UA strings\n  - Handle malformed/unknown user agents gracefully\n  - Purpose: Extract device analytics data\n  - _Leverage: ua-parser-js library or similar_\n  - _Requirements: Requirement 2 (Analytics Tracking - browser, OS, device)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer with expertise in user agent parsing and browser detection | Task: Create user agent parser utility extracting browser, OS, and device type from UA strings following Requirement 2 | Restrictions: Must handle null/undefined/malformed UAs, return null for unparseable values, do not throw errors on invalid input | Leverage: ua-parser-js or similar library | Requirements: Requirement 2 | Success: Utility exports parseUserAgent function, handles edge cases gracefully, includes tests with various UA strings, returns consistent device categorization (desktop/mobile/tablet) | Implementation: Mark task 1.2 as in-progress, implement parser with graceful error handling, test with common/edge-case UAs, log implementation with artifacts (functions: parseUserAgent), mark complete_\n\n- [ ] 1.3. Create GeoIP lookup service\n  - File: src/server/services/geoipService.ts\n  - Implement IP to country/city lookup\n  - Add graceful fallback for lookup failures\n  - Purpose: Geographic analytics data\n  - _Leverage: geoip-lite or maxmind library_\n  - _Requirements: Requirement 2 (Analytics Tracking - country, city), Error Handling (GeoIP Service Failure)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer with expertise in geolocation services and error handling | Task: Create GeoIP lookup service implementing IP to country/city lookup with graceful failure handling following Requirement 2 and Error Handling design | Restrictions: Must handle lookup failures gracefully (return null, log warning), do not block page view tracking on failure, cache lookups for performance | Leverage: geoip-lite or maxmind library | Requirements: Requirement 2, Error Handling scenario 5 | Success: Service exports lookup function, returns {country, city} or null, handles failures without throwing, includes tests with known IPs, logs failures appropriately | Implementation: Mark in-progress, implement with try-catch and null returns, test with valid/invalid/private IPs, log artifacts (functions: lookup, classes: GeoIPService if applicable), mark complete_\n\n### 2. Middleware\n\n- [ ] 2.1. Create rate limiter middleware\n  - File: src/server/middleware/rateLimiter.ts\n  - Implement API rate limiter (100 req/15min per IP)\n  - Implement AI generation limiter (5 req/hour per user)\n  - Add 429 responses with retry-after header\n  - Purpose: Prevent API abuse\n  - _Leverage: express-rate-limit library, existing auth middleware pattern_\n  - _Requirements: Requirement 7 (Security Enhancements - rate limiting)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Security Developer with expertise in rate limiting and API protection | Task: Create rate limiter middleware implementing API (100 req/15min per IP) and AI generation (5 req/hour per user) limits following Requirement 7 and Security design | Restrictions: Must export separate limiters for different endpoints, include retry-after header in 429 responses, use user ID for AI limiter (not IP) | Leverage: express-rate-limit library, auth middleware pattern from src/server/middleware/auth.ts | Requirements: Requirement 7 | Success: Exports apiRateLimiter and aiGenerationRateLimiter middleware, enforces correct limits, returns 429 with retry-after, includes integration tests verifying limit enforcement | Implementation: Mark in-progress, create both limiters with proper configuration, test 101st request returns 429, log artifacts (functions: apiRateLimiter, aiGenerationRateLimiter with purpose), mark complete_\n\n- [ ] 2.2. Create analytics tracking middleware\n  - File: src/server/middleware/analytics.ts\n  - Track page views using IP anonymizer, UA parser, GeoIP service\n  - Insert PageView record into database\n  - Run asynchronously (don't block response)\n  - Purpose: Automatic analytics tracking on public articles\n  - _Leverage: src/server/utils/ipAnonymizer.ts, src/server/utils/userAgentParser.ts, src/server/services/geoipService.ts, existing middleware patterns_\n  - _Requirements: Requirement 2 (Analytics Tracking), Non-functional (Performance - tracking < 100ms)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer with expertise in Express middleware and asynchronous operations | Task: Create analytics tracking middleware recording page views using IP anonymizer, UA parser, and GeoIP service following Requirement 2 and Performance NFR | Restrictions: Must run asynchronously (use res.on('finish')), do not block response, handle all errors gracefully (log but don't fail request), extract article ID from request params | Leverage: ipAnonymizer, userAgentParser, geoipService, middleware pattern from auth.ts | Requirements: Requirement 2, Performance NFR | Success: Exports trackPageView middleware, tracks asynchronously without blocking, handles errors gracefully, stores all required fields (anonymized IP, country, city, browser, OS, device, referrer), includes integration tests verifying PageView creation | Implementation: Mark in-progress, implement async tracking with res.on('finish'), test tracking completes within 100ms, log artifacts (functions: trackPageView, integrations: tracking flow), mark complete_\n\n### 3. Services\n\n- [ ] 3.1. Create analytics service - basic queries\n  - File: src/server/services/analyticsService.ts\n  - Implement getGlobalStats() - total views, articles, brands\n  - Implement getViewsOverTime(filters) - time series aggregation\n  - Add Zod schemas for filter validation\n  - Purpose: Analytics data aggregation\n  - _Leverage: src/server/config/database.ts (db instance), existing service patterns from brandService.ts_\n  - _Requirements: Requirement 3 (Analytics Dashboard - global stats, views over time)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer with expertise in Prisma ORM and data aggregation | Task: Create analytics service implementing getGlobalStats and getViewsOverTime methods following Requirement 3 and existing service patterns | Restrictions: Must use Prisma aggregations (count, groupBy), validate filters with Zod, handle empty results gracefully, follow BrandService class pattern | Leverage: database config, BrandService pattern, Prisma groupBy/count | Requirements: Requirement 3 | Success: Exports AnalyticsService class with getGlobalStats (returns totalViews, totalArticles, totalBrands) and getViewsOverTime (returns array of {date, views}), includes unit tests with mock data, handles date range filters | Implementation: Mark in-progress, implement both methods with Prisma queries, test with mock PageView data, log artifacts (classes: AnalyticsService with methods, functions: getGlobalStats, getViewsOverTime), mark complete_\n\n- [ ] 3.2. Create analytics service - breakdowns\n  - File: src/server/services/analyticsService.ts (continue from 3.1)\n  - Implement getDeviceBreakdown(filters) - device type distribution\n  - Implement getGeographicDistribution(filters) - country stats\n  - Implement getTopArticles(filters) - most viewed articles\n  - Purpose: Analytics breakdowns for dashboard charts\n  - _Leverage: Existing AnalyticsService from task 3.1, Prisma groupBy_\n  - _Requirements: Requirement 3 (Analytics Dashboard - device, geographic, top articles)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer with expertise in data aggregation and SQL/Prisma queries | Task: Add breakdown methods to AnalyticsService (getDeviceBreakdown, getGeographicDistribution, getTopArticles) following Requirement 3 | Restrictions: Must use Prisma groupBy with aggregations, include percentage calculations for device breakdown, sort topArticles by view count descending, respect filter parameters | Leverage: AnalyticsService from task 3.1, Prisma groupBy/include | Requirements: Requirement 3 | Success: Adds getDeviceBreakdown (returns array with device, count, percentage), getGeographicDistribution (returns array with country, count), getTopArticles (returns array with article details and view counts), includes unit tests, handles null values in groupBy | Implementation: Mark in-progress, add three methods to existing service, test aggregations with various filters, log artifacts (functions: three new methods with signatures), mark complete_\n\n- [ ] 3.3. Create analytics service - CSV export\n  - File: src/server/services/analyticsService.ts (continue from 3.2)\n  - Implement streamAnalyticsCSV(res, filters) - streaming CSV export\n  - Stream in batches of 1000 records\n  - Format CSV with proper headers and escaping\n  - Purpose: Large dataset export without memory issues\n  - _Leverage: Existing AnalyticsService from task 3.2, Prisma pagination (skip/take)_\n  - _Requirements: Requirement 4 (Analytics Export), Non-functional (Performance - stream for datasets > 10MB)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer with expertise in streaming data and CSV generation | Task: Add streamAnalyticsCSV method to AnalyticsService implementing streaming CSV export following Requirement 4 and Performance NFR | Restrictions: Must stream data (not load all in memory), use Prisma skip/take for pagination (batches of 1000), set CSV headers (Content-Type, Content-Disposition), escape CSV values properly, do NOT include raw/hashed IPs in export | Leverage: AnalyticsService from task 3.2, Prisma pagination, Express Response stream | Requirements: Requirement 4, Performance NFR | Success: Adds streamAnalyticsCSV method, streams CSV with headers (Timestamp, Article, Brand, Country, City, Browser, OS, Device, Referrer), handles large datasets efficiently, no IPs in export, includes integration test with 5000+ records | Implementation: Mark in-progress, implement streaming with while loop and batches, test memory usage with large dataset, log artifacts (functions: streamAnalyticsCSV with streaming pattern), mark complete_\n\n### 4. Controllers\n\n- [ ] 4.1. Create public article controller\n  - File: src/server/controllers/publicController.ts\n  - Implement viewArticle(req, res) - get published article by slug\n  - Parse brand slug, year, month, article slug from URL params\n  - Return 404 for draft articles or not found\n  - Include related articles in response\n  - Purpose: Public article viewing\n  - _Leverage: Existing controller patterns from articleController.ts, Zod validation_\n  - _Requirements: Requirement 1 (Public Article Viewing), Error Handling (Article Not Found, Article is Draft)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend API Developer with expertise in Express controllers and REST design | Task: Create public article controller implementing viewArticle method following Requirement 1 and error handling design | Restrictions: Must return 404 for draft articles (status !== 'published'), parse URL params (brandSlug, year, month, slug), include brand and relatedArticles in response, follow ArticleController class pattern with Zod validation | Leverage: ArticleController pattern, Zod schemas, error handler | Requirements: Requirement 1, Error scenarios 1-2 | Success: Exports PublicController class with viewArticle static method, returns 404 for draft/missing articles, includes full article with brand and relatedArticles, validates params with Zod, includes integration tests | Implementation: Mark in-progress, implement controller with Prisma include for brand/template, test with published and draft articles, log artifacts (classes: PublicController, apiEndpoints: GET /:brandSlug/article/:year/:month/:slug with format details), mark complete_\n\n- [ ] 4.2. Create analytics controller\n  - File: src/server/controllers/analyticsController.ts\n  - Implement getOverview(req, res) - global stats (super admin only)\n  - Implement getBrandAnalytics(req, res) - brand-specific stats\n  - Implement getArticleAnalytics(req, res) - article-specific stats\n  - Implement exportAnalytics(req, res) - CSV export\n  - Add Zod validation for query params (filters)\n  - Purpose: Analytics API endpoints\n  - _Leverage: src/server/services/analyticsService.ts, existing controller patterns, auth middleware_\n  - _Requirements: Requirement 3 (Analytics Dashboard), Requirement 4 (Analytics Export), Error Handling (Unauthorized, Forbidden)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend API Developer with expertise in RESTful APIs and access control | Task: Create analytics controller implementing four methods (getOverview, getBrandAnalytics, getArticleAnalytics, exportAnalytics) following Requirements 3-4 and error handling | Restrictions: Must validate query params with Zod (startDate, endDate, brandId, articleId), call appropriate AnalyticsService methods, follow controller pattern from ArticleController, handle errors gracefully | Leverage: AnalyticsService, ArticleController pattern, Zod | Requirements: Requirements 3-4, Error scenarios 3-4 | Success: Exports AnalyticsController with four static methods, validates filters with Zod, calls service layer correctly, returns proper JSON responses, includes integration tests for all endpoints | Implementation: Mark in-progress, implement all four methods with validation, test with various filters, log artifacts (classes: AnalyticsController, apiEndpoints: four endpoints with method/path/purpose/formats/location), mark complete_\n\n### 5. Routes\n\n- [ ] 5.1. Create public routes\n  - File: src/server/routes/public.ts\n  - Add GET /:brandSlug/article/:year/:month/:slug route\n  - Apply analytics tracking middleware\n  - Purpose: Public article viewing routes\n  - _Leverage: Existing route patterns from articles.ts, analytics middleware, public controller_\n  - _Requirements: Requirement 1 (Public Article Viewing)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer with expertise in Express routing and middleware chains | Task: Create public routes file defining article viewing route with analytics tracking middleware following Requirement 1 | Restrictions: Must follow Express Router pattern from articles.ts, apply trackPageView middleware to article route, no auth middleware on public routes, export router | Leverage: articles.ts route patterns, trackPageView middleware, PublicController | Requirements: Requirement 1 | Success: Exports Express Router with GET /:brandSlug/article/:year/:month/:slug route, middleware chain includes trackPageView, routes to PublicController.viewArticle, includes integration test | Implementation: Mark in-progress, create router with public route and middleware, test route resolution and tracking, log artifacts (apiEndpoints: public article route with middleware chain), mark complete_\n\n- [ ] 5.2. Create analytics routes\n  - File: src/server/routes/analytics.ts\n  - Add GET /api/analytics/overview (super admin only)\n  - Add GET /api/analytics/brand/:id\n  - Add GET /api/analytics/article/:id\n  - Add GET /api/analytics/export (super admin only)\n  - Apply auth and rate limiter middleware\n  - Purpose: Analytics API routes\n  - _Leverage: Existing route patterns, auth middleware, rate limiter, analytics controller_\n  - _Requirements: Requirement 3 (Analytics Dashboard), Requirement 4 (Analytics Export), Requirement 7 (Security - rate limiting)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer with expertise in protected API routes and middleware composition | Task: Create analytics routes with four endpoints, applying auth and rate limiting middleware following Requirements 3, 4, 7 | Restrictions: Must use auth middleware on all routes, apply apiRateLimiter, export router, follow articles.ts route pattern, overview and export require super admin check | Leverage: articles.ts pattern, auth middleware, apiRateLimiter, AnalyticsController | Requirements: Requirements 3, 4, 7 | Success: Exports Express Router with four routes, middleware chain includes auth and rate limiter, super admin routes have role check, routes to AnalyticsController methods, includes integration tests verifying auth and rate limiting | Implementation: Mark in-progress, create router with all routes and middleware, test auth enforcement and rate limits, log artifacts (apiEndpoints: four analytics endpoints with auth/rate-limit middleware), mark complete_\n\n- [ ] 5.3. Integrate routes into main server\n  - File: src/server/index.ts\n  - Import and mount public and analytics routes\n  - Apply rate limiter to AI generation endpoints\n  - Ensure routes registered after migration service runs\n  - Purpose: Integrate new routes into application\n  - _Leverage: Existing route mounting in index.ts_\n  - _Requirements: All Phase 3 requirements, Critical Implementation Note #1 (migrations before routes)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer with expertise in Express application configuration and startup sequence | Task: Integrate public and analytics routes into main server following all requirements and ensuring correct startup order (migrations â†’ routes) | Restrictions: Must mount routes after migration service runs, apply aiGenerationRateLimiter to existing AI generation endpoint, follow existing route mounting pattern, maintain route order (public routes before API routes for wildcard handling) | Leverage: Existing route configuration in index.ts | Requirements: All Phase 3, Critical Note #1 | Success: Public routes mounted (handles /:brandSlug/article/...), analytics routes mounted at /api/analytics, AI generation has rate limiter, startup order correct (migrations â†’ routes â†’ listen), server starts successfully | Implementation: Mark in-progress, add route imports and mount points, apply rate limiter to AI endpoint, test server startup order, log artifacts (integrations: route mounting and startup sequence), mark complete_\n\n### 6. Database Migrations\n\n- [ ] 6.1. Create analytics indexes migration\n  - File: migrations/1.2.0/001_add_analytics_indexes.sql\n  - Add indexes on PageView (timestamp, articleId, country)\n  - Add indexes on Article (status, publishedAt)\n  - Purpose: Analytics query performance optimization\n  - _Leverage: Existing migration patterns from migrations/1.0.0/, SPEC.md migration format_\n  - _Requirements: Non-functional (Performance - analytics dashboard < 2s), Design (Performance Optimizations - database indexes)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Database Administrator with expertise in SQLite indexing and query optimization | Task: Create migration adding performance indexes for analytics queries following Performance NFR and design | Restrictions: Must use CREATE INDEX IF NOT EXISTS, follow migration file format from SPEC.md (comment header with description/version/date), add indexes on PageView(timestamp), PageView(articleId), PageView(country), Article(status), Article(publishedAt) | Leverage: Migration format from 1.0.0 migrations, SPEC.md lines 271-278 | Requirements: Performance NFR, Design performance section | Success: Migration file with proper header comments, five indexes created with IF NOT EXISTS, SQL syntax valid for SQLite, migration applies successfully on fresh database | Implementation: Mark in-progress, create migration file following format, test migration on test database, log artifacts (no code artifacts, just migration file), mark complete_\n\n- [ ] 6.2. Create system configuration migration\n  - File: migrations/1.2.0/002_add_system_config.sql\n  - Create SystemConfig table for disclaimer configuration\n  - Insert default disclaimer content (EN/ES)\n  - Purpose: Editable disclaimer configuration\n  - _Leverage: Existing migration patterns, Requirement 8 (Disclaimer configuration)_\n  - _Requirements: Requirement 8 (Disclaimer configuration)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Database Developer with expertise in schema design and data seeding | Task: Create migration adding SystemConfig table for editable disclaimers following Requirement 8 | Restrictions: Must create table with columns (id, key, value, updatedAt), use TEXT for id/key/value, insert four default records (disclaimer_banner_en, disclaimer_banner_es, disclaimer_footer_en, disclaimer_footer_es), follow migration format | Leverage: Migration format, Design section on SystemConfig | Requirements: Requirement 8 | Success: Migration creates SystemConfig table with proper schema, seeds four disclaimer records with content from design document, migration applies successfully, table uses TEXT for id with uuid() default | Implementation: Mark in-progress, create table and seed data, test migration applies and data inserts, log artifacts (no code artifacts), mark complete_\n\n- [ ] 6.3. Update Prisma schema\n  - File: prisma/schema.prisma\n  - Add SystemConfig model to match migration\n  - Generate Prisma client\n  - Purpose: Prisma support for SystemConfig table\n  - _Leverage: Existing Prisma schema patterns_\n  - _Requirements: Requirement 8 (Disclaimer configuration)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer with expertise in Prisma ORM and schema design | Task: Add SystemConfig model to Prisma schema and regenerate client following Requirement 8 | Restrictions: Must match migration table structure exactly, use String type for all fields, add @unique on key field, add @updatedAt on updatedAt, run npx prisma generate after changes | Leverage: Existing model patterns from schema.prisma | Requirements: Requirement 8 | Success: SystemConfig model added to schema with correct fields (id String @id @default(uuid()), key String @unique, value String, updatedAt DateTime @updatedAt), prisma generate succeeds, model matches migration exactly | Implementation: Mark in-progress, add model to schema file, run generate command, test model accessible in code, log artifacts (no new artifacts, schema update), mark complete_\n\n### 7. Frontend - Disclaimer Components\n\n- [ ] 7.1. Create disclaimer configuration service\n  - File: src/client/services/disclaimerService.ts\n  - Fetch disclaimer content from SystemConfig\n  - Cache disclaimer data\n  - Purpose: Load editable disclaimers\n  - _Leverage: src/client/services/api.ts patterns_\n  - _Requirements: Requirement 8 (Disclaimer configuration)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Developer with expertise in service layer architecture and caching | Task: Create disclaimer service to fetch and cache disclaimer content from backend following Requirement 8 | Restrictions: Must export getDisclaimerConfig function, use api.ts fetch patterns, cache results in memory, handle fetch errors gracefully (use fallback defaults), return typed DisclaimerConfig object | Leverage: api.ts service patterns | Requirements: Requirement 8 | Success: Exports getDisclaimerConfig async function, fetches from /api/config/disclaimers (you'll need to add this endpoint), caches results, includes TypeScript interface for DisclaimerConfig, handles errors with fallback | Implementation: Mark in-progress, create service with caching, add backend endpoint for config retrieval, test caching works, log artifacts (functions: getDisclaimerConfig, apiEndpoints: GET /api/config/disclaimers if created), mark complete_\n\n- [ ] 7.2. Create disclaimer banner component\n  - File: src/client/components/PublicArticle/DisclaimerBanner.tsx\n  - Implement sticky top banner with warning icon and text\n  - Support EN/ES languages\n  - Purpose: Visible fictional content warning\n  - _Leverage: Tailwind CSS, react-i18next, existing component patterns_\n  - _Requirements: Requirement 1 (Public Article Viewing - sticky banner, disclaimers)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Developer with expertise in React components and responsive design | Task: Create disclaimer banner component implementing sticky warning banner following Requirement 1 | Restrictions: Must use Tailwind for styling (sticky top-0 z-50), use react-i18next for translations, show âš ï¸ icon, background should be visible (yellow/orange), text readable, export default function DisclaimerBanner | Leverage: Tailwind utility classes, i18n from existing pages, disclaimer service for content | Requirements: Requirement 1 | Success: Component renders sticky banner at top, remains visible when scrolling, uses translated text from disclaimerService, accessible and responsive, includes component test | Implementation: Mark in-progress, create component with sticky positioning and i18n, test sticky behavior, log artifacts (components: DisclaimerBanner with purpose/props), mark complete_\n\n- [ ] 7.3. Create watermark component\n  - File: src/client/components/PublicArticle/Watermark.tsx\n  - Implement semi-transparent \"FICTIONAL\" overlay\n  - Rotate -45deg with 3% opacity\n  - Purpose: Visual fictional content indicator\n  - _Leverage: Tailwind CSS, fixed positioning_\n  - _Requirements: Requirement 1 (Public Article Viewing - watermark)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Developer with expertise in CSS positioning and visual effects | Task: Create watermark component implementing semi-transparent overlay following Requirement 1 | Restrictions: Must use fixed positioning, opacity-[0.03], rotate-[-45deg], z-index below content, large text (text-8xl or larger), color gray, pointer-events-none, export default function Watermark | Leverage: Tailwind transform utilities, fixed positioning | Requirements: Requirement 1 | Success: Component renders \"FICTIONAL\" text diagonally across page, 3% opacity, fixed position, doesn't interfere with interaction, responsive, includes component test | Implementation: Mark in-progress, create component with CSS transforms, test visual appearance and non-interference, log artifacts (components: Watermark), mark complete_\n\n- [ ] 7.4. Create disclaimer footer component\n  - File: src/client/components/PublicArticle/DisclaimerFooter.tsx\n  - Implement footer with full disclaimer text\n  - Support EN/ES languages\n  - Purpose: Complete fictional content explanation\n  - _Leverage: Tailwind CSS, react-i18next, disclaimer service_\n  - _Requirements: Requirement 1 (Public Article Viewing - footer disclaimer)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Developer with expertise in React and content presentation | Task: Create disclaimer footer component with full explanation text following Requirement 1 | Restrictions: Must use react-i18next for translations, load content from disclaimerService, use semantic HTML (<footer>), style with Tailwind (background, padding, text size), export default function DisclaimerFooter | Leverage: i18n, disclaimerService, Tailwind | Requirements: Requirement 1 | Success: Component renders footer with title and content text, uses translated disclaimer from service, visually distinct (background color), readable typography, responsive, includes test | Implementation: Mark in-progress, create footer with i18n integration, test rendering with both languages, log artifacts (components: DisclaimerFooter), mark complete_\n\n### 8. Frontend - Public Article Page\n\n- [ ] 8.1. Create public article page\n  - File: src/client/pages/PublicArticle.tsx\n  - Implement public article viewing page\n  - Integrate disclaimer banner, watermark, footer\n  - Display article content with related articles sidebar\n  - Add meta tags (noindex, nofollow, OG tags with [FICTIONAL])\n  - Handle loading and error states\n  - Purpose: Public article viewing experience\n  - _Leverage: Existing page patterns from Dashboard.tsx, ArticleView.tsx, disclaimer components_\n  - _Requirements: Requirement 1 (Public Article Viewing - all aspects), Error Handling (Article Not Found)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Full-stack Frontend Developer with expertise in React, routing, and SEO | Task: Create public article page integrating all disclaimer components and meta tags following Requirement 1 | Restrictions: Must use react-router-dom params (:brandSlug, :year, :month, :slug), fetch article from PublicController endpoint, integrate DisclaimerBanner, Watermark, DisclaimerFooter components, add Helmet with meta tags (robots noindex,nofollow, OG tags with [FICTIONAL] prefix), display related articles in sidebar, show 404 for not found, use Tailwind | Leverage: Dashboard/ArticleView page patterns, react-helmet-async, disclaimer components, useParams hook | Requirements: Requirement 1, Error scenario 1 | Success: Page renders article with all disclaimers, meta tags present in HTML head, related articles shown, 404 page for missing articles, loading and error states, responsive layout, includes E2E test | Implementation: Mark in-progress, create page with routing and meta tags, test with published/draft articles, log artifacts (components: PublicArticle page, integrations: disclaimer components integration), mark complete_\n\n- [ ] 8.2. Add public article route to router\n  - File: src/client/App.tsx\n  - Add route for /:brandSlug/article/:year/:month/:slug\n  - Ensure route doesn't require authentication\n  - Purpose: Enable public article access\n  - _Leverage: Existing React Router configuration in App.tsx_\n  - _Requirements: Requirement 1 (Public Article Viewing)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Developer with expertise in React Router and application routing | Task: Add public article route to React Router configuration following Requirement 1 | Restrictions: Must place route outside PrivateRoute wrapper (public access), use exact path /:brandSlug/article/:year/:month/:slug, import PublicArticle component, follow existing route patterns, ensure route resolves before catch-all 404 | Leverage: Existing routing in App.tsx, React Router v6 patterns | Requirements: Requirement 1 | Success: Route added and accessible without auth, matches URL pattern correctly, renders PublicArticle component, includes test verifying public access | Implementation: Mark in-progress, add route in correct position, test route resolution and public access, log artifacts (no new artifacts, routing configuration), mark complete_\n\n### 9. Frontend - Analytics Components\n\n- [ ] 9.1. Create analytics filters component\n  - File: src/client/components/Analytics/AnalyticsFilters.tsx\n  - Implement date range, brand, article filter controls\n  - Emit filter changes to parent\n  - Purpose: Analytics data filtering\n  - _Leverage: Existing form patterns, Tailwind CSS_\n  - _Requirements: Requirement 3 (Analytics Dashboard - filtering)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Developer with expertise in React forms and controlled components | Task: Create analytics filters component with date range, brand, and article selectors following Requirement 3 | Restrictions: Must use controlled inputs, emit onFilterChange with filters object {startDate, endDate, brandId, articleId}, include \"Apply Filters\" button, use react-i18next for labels, style with Tailwind, export default function AnalyticsFilters | Leverage: Form input patterns from existing pages, Tailwind, i18n | Requirements: Requirement 3 | Success: Component renders four inputs (start date, end date, brand select, article select), onFilterChange prop receives filters object, includes \"Apply\" button, uses translations, responsive layout, includes component test | Implementation: Mark in-progress, create component with controlled inputs and state, test filter emission, log artifacts (components: AnalyticsFilters with props interface), mark complete_\n\n- [ ] 9.2. Create analytics charts component\n  - File: src/client/components/Analytics/AnalyticsCharts.tsx\n  - Implement Recharts visualizations (line, pie, bar)\n  - Display loading states\n  - Purpose: Analytics data visualization\n  - _Leverage: recharts library, Tailwind grid layout_\n  - _Requirements: Requirement 3 (Analytics Dashboard - line chart, pie chart, bar chart)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Developer with expertise in data visualization and Recharts | Task: Create analytics charts component rendering three chart types (line, pie, bar) following Requirement 3 | Restrictions: Must import from recharts (LineChart, PieChart, BarChart), use ResponsiveContainer for responsive charts, display loading state when data is null, use props {data: AnalyticsData | null, loading: boolean}, render line chart (views over time), pie chart (device breakdown with percentages), bar chart (geographic distribution), style with Tailwind grid, export default function AnalyticsCharts | Leverage: Recharts components, Tailwind grid, React.memo for performance | Requirements: Requirement 3 | Success: Component renders three charts when data present, shows loading spinner when loading, charts are responsive, uses proper Recharts configuration (axes, tooltips, legends), includes component test with mock data | Implementation: Mark in-progress, create charts with Recharts, test with sample data, log artifacts (components: AnalyticsCharts with chart types), mark complete_\n\n- [ ] 9.3. Create top articles table component\n  - File: src/client/components/Analytics/TopArticlesTable.tsx\n  - Display table of most viewed articles\n  - Show article title, brand, view count, last viewed date\n  - Purpose: Top performing content display\n  - _Leverage: Tailwind table styles, existing table patterns_\n  - _Requirements: Requirement 3 (Analytics Dashboard - top articles table)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Developer with expertise in data tables and React components | Task: Create top articles table component displaying most viewed articles following Requirement 3 | Restrictions: Must use HTML table element, props {articles: TopArticle[]}, display columns (title, brand, views, last viewed), sort by views descending (handled by backend), use Tailwind for styling (striped rows, hover effects), use react-i18next for headers, export default function TopArticlesTable | Leverage: Tailwind table classes, i18n | Requirements: Requirement 3 | Success: Component renders table with four columns, shows data correctly formatted, responsive table (overflow-x-auto), includes empty state for no data, uses translations for headers, includes test | Implementation: Mark in-progress, create table component with proper structure, test with mock data and empty array, log artifacts (components: TopArticlesTable), mark complete_\n\n- [ ] 9.4. Create analytics page\n  - File: src/client/pages/Analytics.tsx\n  - Integrate filters, charts, and table components\n  - Fetch analytics data from API\n  - Implement CSV export functionality\n  - Add role-based access control (authenticated users only)\n  - Purpose: Analytics dashboard\n  - _Leverage: Existing page patterns, AuthContext, api service, analytics components_\n  - _Requirements: Requirement 3 (Analytics Dashboard), Requirement 4 (Analytics Export), Error Handling (Unauthorized, Forbidden)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Full-stack Frontend Developer with expertise in React state management and API integration | Task: Create analytics page integrating filters, charts, and table with API data fetching and CSV export following Requirements 3-4 | Restrictions: Must use useAuth hook for role check, fetch data from /api/analytics endpoints, manage filter state with useState, call analytics endpoints with filters, implement \"Export CSV\" button triggering /api/analytics/export download, show loading states, handle errors, use Dashboard layout pattern, integrate AnalyticsFilters, AnalyticsCharts, TopArticlesTable components | Leverage: Dashboard page pattern, useAuth hook, api service, analytics components | Requirements: Requirements 3-4, Error scenarios 3-4 | Success: Page renders with all three child components, fetches data on mount and filter change, export button downloads CSV, shows loading during fetch, displays errors gracefully, only accessible to authenticated users, includes E2E test | Implementation: Mark in-progress, create page with state management and API calls, test data flow and export, log artifacts (components: Analytics page, integrations: API integration with filters and export), mark complete_\n\n- [ ] 9.5. Add analytics page to navigation\n  - File: src/client/pages/Dashboard.tsx\n  - Add \"Analytics\" link to dashboard navigation\n  - Add /analytics route to App.tsx\n  - Purpose: Make analytics accessible from dashboard\n  - _Leverage: Existing navigation in Dashboard.tsx, routing in App.tsx_\n  - _Requirements: Requirement 3 (Analytics Dashboard)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Developer with expertise in React navigation and routing | Task: Add analytics navigation link and route following Requirement 3 | Restrictions: Must add Link to /analytics in Dashboard quick actions grid, use appropriate icon (ðŸ“Š or ðŸ“ˆ), add route in App.tsx within PrivateRoute (auth required), follow existing quick action card pattern (same Tailwind classes), use i18n for link text | Leverage: Dashboard quick actions pattern, App.tsx routing | Requirements: Requirement 3 | Success: Analytics link appears in dashboard alongside Articles/Brands/Templates, navigates to /analytics on click, route renders Analytics page with auth requirement, uses translation, includes test | Implementation: Mark in-progress, add navigation card and route, test navigation flow, log artifacts (no new artifacts, navigation integration), mark complete_\n\n### 10. Internationalization\n\n- [ ] 10.1. Add analytics translations\n  - Files: src/client/locales/en/common.json, src/client/locales/es/common.json\n  - Add translation keys for analytics terms\n  - Add translation keys for disclaimer text\n  - Add translation keys for public article terms\n  - Purpose: Complete EN/ES support\n  - _Leverage: Existing translation structure_\n  - _Requirements: Requirement 5 (Internationalization), Requirement 1 (Disclaimer in article language)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Developer with expertise in internationalization and content localization | Task: Add comprehensive translations for analytics, disclaimers, and public article UI following Requirement 5 | Restrictions: Must add \"analytics\" object with keys (title, overview, totalViews, totalArticles, viewsOverTime, deviceBreakdown, geographicDistribution, topArticles, export, filters.dateRange, filters.brand, filters.article, filters.apply), \"disclaimer\" object with keys (banner, footer.title, footer.content), \"public\" object with keys (notFound, readTime, relatedArticles), translations must be natural and accurate, follow existing JSON structure | Leverage: Existing common.json files, Design document translation examples | Requirements: Requirements 1, 5 | Success: Both EN and ES files updated with all required keys, translations are accurate and natural, no missing keys, JSON is valid, includes manual verification of both languages in UI | Implementation: Mark in-progress, add all translation keys to both files, verify JSON validity, test in UI with language switching, log artifacts (no code artifacts, translation content), mark complete_\n\n### 11. Production Hardening\n\n- [ ] 11.1. Add health check endpoint\n  - File: src/server/index.ts or src/server/routes/health.ts\n  - Implement GET /health endpoint\n  - Check database connection and return version info\n  - Return 503 on database failure\n  - Purpose: Monitoring and health checks\n  - _Leverage: Existing server setup, database connection_\n  - _Requirements: Requirement 6 (Production Hardening - health check)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: DevOps Engineer with expertise in health checks and monitoring | Task: Create health check endpoint returning system status and version information following Requirement 6 and Design health check section | Restrictions: Must attempt database query (db.$queryRaw`SELECT 1`), return 200 {status: 'healthy', version, dbVersion, timestamp} on success, return 503 {status: 'unhealthy', error} on database failure, use try-catch, add route before or after other routes (doesn't matter for /health) | Leverage: Database connection, AppVersion model | Requirements: Requirement 6, Design health check | Success: GET /health returns 200 with status object when DB works, returns 503 when DB fails, includes app version from package.json and DB version from AppVersion table, includes integration test | Implementation: Mark in-progress, implement endpoint with DB check, test both success and failure scenarios, log artifacts (apiEndpoints: GET /health with response format), mark complete_\n\n- [ ] 11.2. Add winston logging\n  - File: src/server/config/logger.ts\n  - Configure Winston logger with file and console transports\n  - Set up error and combined logs\n  - Replace console.log with logger in key areas\n  - Purpose: Production-grade logging\n  - _Leverage: winston library_\n  - _Requirements: Requirement 6 (Production Hardening - logging), Error Handling (log all failures)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer with expertise in logging and observability | Task: Configure Winston logger for production logging following Requirement 6 and Design logging section | Restrictions: Must create logger with two transports (File for error.log level error, File for combined.log level info), add Console transport for non-production, use JSON format for files, export logger instance, do not replace all console.logs (only critical areas like errors, startup, tracking failures) | Leverage: winston library, Design winston configuration example | Requirements: Requirement 6 | Success: Logger configured with proper transports and formats, exports logger instance, creates log files on write, includes test verifying log output, used in error handler and analytics middleware | Implementation: Mark in-progress, create logger config, integrate into error handler and middleware, test log file creation, log artifacts (functions: logger instance, classes: if using class wrapper), mark complete_\n\n- [ ] 11.3. Add helmet.js security headers\n  - File: src/server/index.ts\n  - Add helmet middleware with CSP configuration\n  - Enable HSTS and other security headers\n  - Purpose: Security hardening\n  - _Leverage: helmet library_\n  - _Requirements: Requirement 7 (Security Enhancements - security headers), Design (Security Headers section)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Security Engineer with expertise in web application security and HTTP headers | Task: Add helmet.js middleware with CSP and HSTS configuration following Requirement 7 and Design security headers section | Restrictions: Must install helmet, add app.use(helmet({...})) early in middleware chain (before routes), configure contentSecurityPolicy with directives (defaultSrc self, scriptSrc self unsafe-inline, styleSrc self unsafe-inline, imgSrc self data https), configure hsts with maxAge 31536000 and includeSubDomains, use Design example as reference | Leverage: helmet library, Design helmet configuration | Requirements: Requirement 7, Design security headers | Success: Helmet middleware applied, CSP headers present in responses, HSTS configured correctly, other default helmet protections enabled, includes test verifying headers present | Implementation: Mark in-progress, install and configure helmet, test headers in response, log artifacts (no new artifacts, middleware configuration), mark complete_\n\n- [ ] 11.4. Create database backup script\n  - File: scripts/backup-db.sh\n  - Implement daily backup script for SQLite\n  - Keep last 7 days of backups\n  - Purpose: Data protection\n  - _Leverage: Shell scripting, cron_\n  - _Requirements: Requirement 6 (Production Hardening - database backups)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: DevOps Engineer with expertise in backup strategies and shell scripting | Task: Create automated database backup script following Requirement 6 and Design backup section | Restrictions: Must create backups directory, copy fictional_news.db with timestamp suffix (YYYYMMDD_HHMMSS), delete backups older than 7 days using find command, make script executable (chmod +x), add shebang (#!/bin/bash), use Design example script as reference | Leverage: Design backup script example, bash scripting | Requirements: Requirement 6, Design backup section | Success: Script creates timestamped backup copies, removes old backups correctly, script is executable and runs without errors, includes README.md in scripts/ explaining setup and cron configuration | Implementation: Mark in-progress, create script following design, test backup creation and cleanup, log artifacts (no code artifacts, backup script), mark complete_\n\n- [ ] 11.5. Add graceful shutdown handling\n  - File: src/server/index.ts\n  - Implement SIGTERM/SIGINT handlers\n  - Close server and disconnect database on shutdown\n  - Purpose: Clean server shutdown\n  - _Leverage: Node.js process events_\n  - _Requirements: Requirement 6 (Production Hardening), Design (Graceful Shutdown section)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer with expertise in Node.js process management and graceful shutdown | Task: Add graceful shutdown handlers for clean server termination following Requirement 6 and Design shutdown section | Restrictions: Must listen for SIGTERM and SIGINT signals, call server.close() on signal, call db.$disconnect() after server closes, log shutdown messages, set timeout to force exit after 10s if cleanup hangs, use Design example as reference | Leverage: Design graceful shutdown example, server and db instances | Requirements: Requirement 6, Design shutdown | Success: Process handles SIGTERM/SIGINT gracefully, server stops accepting new connections, existing connections finish, database disconnects cleanly, includes test or manual verification | Implementation: Mark in-progress, add signal handlers to server startup, test with kill signal, log artifacts (no new artifacts, shutdown handling), mark complete_\n\n### 12. Testing\n\n- [ ] 12.1. Write unit tests for utilities\n  - Files: tests/unit/utils/ipAnonymizer.test.ts, tests/unit/utils/userAgentParser.test.ts\n  - Test IP hashing consistency and edge cases\n  - Test UA parsing with various user agents\n  - Purpose: Utility reliability\n  - _Leverage: Jest, existing test patterns_\n  - _Requirements: Testing Strategy (Unit Testing)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in unit testing and test-driven development | Task: Create comprehensive unit tests for IP anonymizer and UA parser utilities following Testing Strategy | Restrictions: Must test ipAnonymizer with known IP/hash pairs, test consistency (same input = same output), test null/undefined handling, test UA parser with Chrome/Firefox/Safari/Edge/mobile UAs, test malformed UAs return null gracefully, use Jest, follow existing test file patterns, aim for 90%+ coverage | Leverage: Jest, existing test patterns from tests/unit/ | Requirements: Testing Strategy unit tests | Success: Both test files created with comprehensive coverage, tests pass consistently, edge cases covered (null, undefined, malformed), includes known test vectors | Implementation: Mark in-progress, write tests for both utilities, run npm test to verify, log artifacts (no new artifacts, test files), mark complete_\n\n- [ ] 12.2. Write unit tests for services\n  - Files: tests/unit/services/analyticsService.test.ts, tests/unit/services/geoipService.test.ts\n  - Mock Prisma for analytics service tests\n  - Test aggregation logic and error handling\n  - Purpose: Service layer reliability\n  - _Leverage: Jest, Prisma mocking patterns_\n  - _Requirements: Testing Strategy (Unit Testing)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in service testing and mocking frameworks | Task: Create unit tests for analytics and GeoIP services with proper mocking following Testing Strategy | Restrictions: Must mock Prisma client for analytics service (use jest.mock), test all service methods (getGlobalStats, getViewsOverTime, getDeviceBreakdown, etc.), test with empty results, test filter handling, test GeoIP lookup with known IPs and failures, aim for 80%+ coverage | Leverage: Jest mocking, existing service test patterns | Requirements: Testing Strategy unit tests | Success: Both service test files created, all methods tested with mocked dependencies, error scenarios covered, tests isolated and fast, good coverage | Implementation: Mark in-progress, create tests with comprehensive mocking, run and verify all pass, log artifacts (no new artifacts, test files), mark complete_\n\n- [ ] 12.3. Write integration tests for API endpoints\n  - Files: tests/integration/publicController.test.ts, tests/integration/analyticsController.test.ts\n  - Test public article viewing with published/draft articles\n  - Test analytics endpoints with filters and auth\n  - Test CSV export\n  - Purpose: API reliability and integration\n  - _Leverage: Supertest, existing integration test patterns_\n  - _Requirements: Testing Strategy (Integration Testing)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in API testing and integration tests | Task: Create integration tests for public and analytics controllers following Testing Strategy | Restrictions: Must use Supertest, test real database (test DB), test GET /:brandSlug/article/:year/:month/:slug with published article (200), draft article (404), not found (404), test analytics endpoints with auth header, without auth (401), with filters (query params), test CSV export format and headers, clean up test data in afterEach, use existing integration test patterns | Leverage: Supertest, existing integration tests | Requirements: Testing Strategy integration tests | Success: Both integration test files created, tests use real test database, all endpoints tested with success and error cases, auth enforced, CSV export verified, tests clean up properly | Implementation: Mark in-progress, create integration tests for all endpoints, verify tests pass, log artifacts (no new artifacts, test files), mark complete_\n\n- [ ] 12.4. Write E2E tests with Playwright\n  - File: tests/e2e/phase3-analytics.spec.ts\n  - Test public article viewing with disclaimers\n  - Test analytics dashboard access and filtering\n  - Test language switching on public and analytics pages\n  - Purpose: End-to-end user experience validation\n  - _Leverage: Playwright, existing E2E test setup_\n  - _Requirements: Testing Strategy (E2E Testing)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Automation Engineer with expertise in E2E testing and Playwright | Task: Create end-to-end tests covering public article viewing and analytics dashboard following Testing Strategy | Restrictions: Must write Playwright tests, test public article viewing (navigate to article URL, verify disclaimer banner visible, verify watermark present, verify footer disclaimer), test analytics dashboard (login, navigate to analytics, verify charts render, apply filters, verify data updates), test language switching (switch to ES, verify translations), test CSV export (click export, verify download), use existing E2E patterns from tests/e2e/ | Leverage: Playwright, existing E2E setup | Requirements: Testing Strategy E2E tests, All requirements | Success: E2E test file created with all scenarios, tests pass consistently, covers critical user journeys (public viewing, analytics dashboard, language switching), verifies visual elements (disclaimers, charts) | Implementation: Mark in-progress, write E2E tests for key flows, run npx playwright test to verify, log artifacts (no new artifacts, test files), mark complete_\n\n- [ ] 12.5. Write component tests for React components\n  - Files: tests/unit/components/DisclaimerBanner.test.tsx, tests/unit/components/AnalyticsCharts.test.tsx, tests/unit/components/AnalyticsFilters.test.tsx\n  - Test component rendering with various props\n  - Test user interactions (filter changes, etc.)\n  - Purpose: Component reliability and behavior\n  - _Leverage: React Testing Library, Jest_\n  - _Requirements: Testing Strategy (Unit Testing - components)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend QA Engineer with expertise in React component testing and React Testing Library | Task: Create component tests for disclaimer banner, analytics charts, and analytics filters following Testing Strategy | Restrictions: Must use React Testing Library, test DisclaimerBanner renders with text and icon, test AnalyticsCharts renders three chart types with mock data and loading state, test AnalyticsFilters emits filter changes on apply button click, test with EN/ES languages, use userEvent for interactions, follow existing component test patterns | Leverage: React Testing Library, Jest, existing component tests | Requirements: Testing Strategy unit tests | Success: Three component test files created, components render correctly with various props, user interactions tested (button clicks, filter changes), i18n tested, tests pass consistently | Implementation: Mark in-progress, write tests for all three components, run tests to verify, log artifacts (no new artifacts, test files), mark complete_\n\n### 13. Documentation and Finalization\n\n- [ ] 13.1. Update version and create changelog entry\n  - Files: package.json, CHANGELOG.md\n  - Bump version to 1.2.0 using npm run version:minor\n  - Add Phase 3 features to CHANGELOG.md\n  - Purpose: Version tracking and release notes\n  - _Leverage: Existing version scripts, CHANGELOG format_\n  - _Requirements: Versioning System (1.2.0 release)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Release Manager with expertise in semantic versioning and changelog management | Task: Update version to 1.2.0 and document Phase 3 changes following Versioning System from SPEC.md | Restrictions: Must run npm run version:minor (updates package.json and package-lock.json, creates commit), add CHANGELOG.md entry for 1.2.0 with sections (Added, Changed, Fixed), list all Phase 3 features (public article viewing, analytics dashboard, disclaimers, i18n, security hardening), follow existing CHANGELOG format, use conventional commits format | Leverage: npm version scripts, CHANGELOG format | Requirements: SPEC.md versioning system | Success: Version bumped to 1.2.0, package.json updated, CHANGELOG.md has new entry with all Phase 3 features listed, commit created with proper message | Implementation: Mark in-progress, run version script, update changelog, verify commit created, log artifacts (no code artifacts, version bump), mark complete_\n\n- [ ] 13.2. Run full test suite and verify coverage\n  - Command: npm run test:ci\n  - Verify all unit, integration, and E2E tests pass\n  - Verify test coverage meets 75% target\n  - Purpose: Quality assurance before deployment\n  - _Leverage: Existing test scripts_\n  - _Requirements: Testing Requirements (75%+ coverage), Success Criteria (all tests pass)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Lead with expertise in test automation and quality assurance | Task: Run complete test suite and verify coverage targets following Testing Requirements | Restrictions: Must run npm run test:ci (runs unit/integration with coverage and E2E tests), verify all tests pass, verify coverage >= 75%, if tests fail must fix before proceeding, if coverage low must add tests, generate coverage report | Leverage: npm test scripts, coverage reports | Requirements: Testing Requirements, Success Criteria | Success: All tests pass (unit, integration, E2E), coverage is 75%+, coverage report generated, no failing tests, ready for deployment | Implementation: Mark in-progress, run test:ci command, review results and coverage, fix any failures, log artifacts (no code artifacts, test results), mark complete_\n\n- [ ] 13.3. Test Docker build and deployment\n  - Commands: docker-compose build, docker-compose up\n  - Verify application starts successfully in Docker\n  - Verify health check endpoint works\n  - Verify migrations run on startup\n  - Purpose: Deployment validation\n  - _Leverage: Existing Dockerfile and docker-compose.yml_\n  - _Requirements: Deployment Instructions (Docker), Success Criteria (Docker deployment works)_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: DevOps Engineer with expertise in Docker containerization and deployment | Task: Test Docker build and verify application runs correctly in container following Deployment Instructions | Restrictions: Must run docker-compose build to build image, run docker-compose up -d to start container, verify container starts (docker ps), verify health check returns 200 (curl http://localhost:3000/health), verify migrations ran (check logs or database), test public article viewing and analytics dashboard, run docker-compose down to cleanup | Leverage: Existing Docker configuration | Requirements: Deployment Instructions, Success Criteria | Success: Docker image builds successfully, container starts without errors, health check passes, migrations applied, application fully functional in container, public articles and analytics accessible | Implementation: Mark in-progress, run Docker commands and verify, test application in container, log artifacts (no code artifacts, deployment verification), mark complete_\n\n- [ ] 13.4. Create migration guide and update README\n  - Files: migrations/1.2.0/README.md, README.md\n  - Document migration steps for Phase 3\n  - Update README with new features\n  - Purpose: User documentation and migration guidance\n  - _Leverage: Existing documentation format_\n  - _Requirements: Deployment Instructions, Phase 3 features_\n  - _Prompt: Implement the task for spec public-analytics, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical Writer with expertise in documentation and migration guides | Task: Create migration documentation and update README with Phase 3 features | Restrictions: Must create migrations/1.2.0/README.md explaining migration files and manual steps (if any), update root README.md with Phase 3 features section (Public Article Viewing, Analytics Dashboard, i18n, Security), document new environment variables if any, document new npm scripts, follow existing README format | Leverage: Existing README and migration docs | Requirements: All Phase 3 requirements | Success: Migration README created with clear instructions, root README updated with Phase 3 features, new features documented clearly, includes examples or screenshots if applicable, documentation is accurate and complete | Implementation: Mark in-progress, write both documentation files, review for accuracy, log artifacts (no code artifacts, documentation), mark complete_\n",
  "fileStats": {
    "size": 64064,
    "lines": 433,
    "lastModified": "2025-12-14T13:37:50.735Z"
  },
  "comments": []
}